
{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->

    <link rel="stylesheet" href="{% static 'dist/css/bootstrap.min.css' %} ">
    <link rel="stylesheet" href="{% static 'dist/css/estilos.css' %}">

    <title>Login</title>
  </head>

  <body>
    <div class="container p-3 my-3 border">
        <div class="row">
          <div class="col">          
            <img src="{% static 'dist/img/cesfam.png' %}" width="100" alt="100">
            <h6>Centros de Salud Familiar</h6>    
          </div>
        </div>

        <br>
        <div class="row align-items-stretch">
          <div class="col-3 d-none d-lg-block">
            <br>
            <br>
            <br>
            <br>
            <ul class="foto">
              <img src="{% static 'dist/img/login.png' %}" width="200" alt="200" >
            </ul>            
              
          </div>
            
          <div class="col-9 p-5">
            <h2 class="fw-bold text-center">Inicio sesión usuarios CESFAM</h2>

            <!-- Login -->
            <form action="loginMail()">
                <!-- Correo -->
                <div class="form-mb-6">
                    <label for="correo_login"><span class="red">* </span>Correo</label>
                    <input type="email" name="email" id="correo_login" class="form-control" placeholder="correo_login" required multiple>
                </div>

                <!-- Contraseña -->
                <div class="form-mb-6">
                    <label for="contrasena_login"><span class="red">* </span>Contraseña</label>
                    <input type="password" name="contraseña" id="contrasena_login" class="form-control" placeholder="contrasena_login" required multiple>
                </div>

                <!-- Btn login -->
                <div>
                    <button type="submit" class="btn btn-primary btn-block">INICIAR</button>
                </div>

            </form>
            <form id="form1"> 
              <div class="form-mb-6 ">
                <label class="form-label" >Rut usuario</label>
                <input type="text" class="form-control" id="rutUsuario" >
                <div class="invalid-feedback" id="rut" ></div>
              </div>
              <br>
              <div class="form-mb-6">
                <label class="form-label" >Contraseña</label>
                <input type="password" class="form-control" id="passwordUsuario">
                <div class="invalid-feedback" id="password" ></div>
                <br>
              </div>
              <br>
              <div>
                <button type="button" class="btn btn-primary btn-block" onclick="loginMail()">Entrar</button>
              </div>
              <br>
            </form>
            <br>
            <br>                       
          </div>
        </div>
        
        
        
      </div>    
  <script src="{% static 'dist/js/jquery-3.6.0.js' %}"></script>
  <script src="{% static 'dist/js/popper.js' %}"></script>
  <script src="{% static 'dist/js/bootstrap.js' %}"></script>
  <script src="{% static 'dist/js/validaciones.js' %}"></script>
  <script src="https://www.gstatic.com/firebasejs/9.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.7.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.7.0/firebase-auth-compat.js"></script>
  <script type="text/javascript">

    import { firebaseConfig } from 'web/static/js/config.js'

    // Configuración credenciales acceso
    console.log(firebaseConfig);
    const firebaseApp = firebase.initializeApp(firebaseConfig);
    const db = firebaseApp.firestore();
    const auth = firebaseApp.auth();
    
    // LOG IN
    function loginMail(){
        console.log('Iniciando login...');
    
        // Datos de entrada
        const email = document.getElementById('emailUsuario').value;
        const password = document.getElementById('passwordUsuario').value;
    
        console.log(email, password);
    
        firebase.auth().signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
            // Signed in
            var user = userCredential.user;
            console.log('¡SESIÓN INICIADA!');
            console.log(user);
            // Redireccionamiento a la nueva vista
            // ...
        })
        .catch((error) => {
            var errorCode = error.code;
            var errorMessage = error.message;
            console.log('ERROR: código: ', errorCode);
            console.log('ERROR: mensaje: ', errorMessage);
        });
    }
  </script>
  </body>
</html>
